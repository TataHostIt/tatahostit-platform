cloudflare-tunnel:
  # 1. Image & Replica Configuration
  image:
    repository: cloudflare/cloudflared
    pullPolicy: IfNotPresent
    # tag: 2024.12.0 # Optional: pin a version if you want stability

  # 1. CORRECT REPLICA CONFIGURATION
  # The chart uses 'replica' object, not 'replicaCount'
  replica:
    count: 2
    allNodes: false # Set to true if you want a DaemonSet instead

  # 2. INGRESS CONFIGURATION
  # Routes all traffic to your internal Nginx Ingress
  ingress:
    - service: http://ingress-nginx-controller.ingress-nginx.svc.cluster.local:80
    - service: "http_status:404"

  # 3. AUTHENTICATION
  # This chart REQUIRES a secret with a JSON file.
  # We point to your existing secret, but you must update the secret's content (see Step 3 below).
  tunnelSecrets:
    existingConfigJsonFileSecret:
      name: cloudflared-tunnel-token
      key: credentials.json

  # 4. RESOURCES (Always good practice)
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi