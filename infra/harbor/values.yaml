expose:
  type: ingress
  tls:
    enabled: true
    certSource: secret
    secret:
      secretName: harbor-tls # Cert-manager will store the cert here
  ingress:
    hosts:
      core: harbor.tatahostit.com
    controller: default
    className: "nginx"
    annotations:
      # CERT MANAGER
      # Change to 'letsencrypt-staging' first if you want to test without rate limits
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      # NGINX
      ingress.kubernetes.io/ssl-redirect: "true"
      ingress.kubernetes.io/proxy-body-size: "0"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: "0"

externalURL: https://harbor.tatahostit.com

# ---------------------------------------------------------
# PERSISTENCE & STORAGE
# ---------------------------------------------------------
persistence:
  enabled: true
  resourcePolicy: "keep"
  persistentVolumeClaim:
    registry:
      storageClass: "sc-nvme"
      accessMode: ReadWriteOnce
      size: 50Gi # Large enough for Docker Build Cache
    jobservice:
      jobLog:
        storageClass: "sc-nvme"
        accessMode: ReadWriteOnce
        size: 5Gi
    database:
      storageClass: "sc-nvme"
      accessMode: ReadWriteOnce
      size: 10Gi
    redis:
      storageClass: "sc-nvme"
      accessMode: ReadWriteOnce
      size: 5Gi
    trivy:
      storageClass: "sc-nvme"
      accessMode: ReadWriteOnce
      size: 10Gi
  imageChartStorage:
    type: filesystem
    filesystem:
      rootdirectory: /storage

# ---------------------------------------------------------
# GLOBAL SECRET CONFIG
# ---------------------------------------------------------
# 1. Admin Password -> Maps to key HARBOR_ADMIN_PASSWORD in your secret
existingSecretAdminPassword: "harbor-core-secrets"
existingSecretAdminPasswordKey: "HARBOR_ADMIN_PASSWORD"

# 2. Encryption Key -> Maps to key 'secretKey' in your secret
# We set this to point to the secret name. The chart expects the key inside to be named "secretKey".
existingSecretSecretKey: "harbor-core-secrets"

# 3. Dummy value to satisfy Helm validation (it won't be used because existingSecretSecretKey is set)
secretKey: "not-used-override-in-secret"

# ---------------------------------------------------------
# COMPONENTS (Secrets + Resources Merged)
# ---------------------------------------------------------

core:
  secretAnnotations: {}
  # Resources
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

jobservice:
  secretAnnotations: {}
  # Secret Mapping
  existingSecret: "harbor-core-secrets"
  existingSecretKey: "JOBSERVICE_SECRET"
  secret: "" # Disable auto-gen
  # Resources
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

registry:
  secretAnnotations: {}
  registry:
    secretAnnotations: {}
    # Secret Mapping
    existingSecret: "harbor-core-secrets"
    existingSecretKey: "REGISTRY_HTTP_SECRET"
    secret: "" # Disable auto-gen
    # Resources (High RAM for caching)
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "2Gi"
        cpu: "2000m"
  controller:
    resources:
      requests:
        memory: "128Mi"
        cpu: "50m"

# ---------------------------------------------------------
# DATABASES (Internal)
# ---------------------------------------------------------
database:
  type: internal
  internal:
    # Resources
    resources:
      requests:
        memory: "256Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    shmSizeLimit: 512Mi

redis:
  type: internal
  internal:
    # Resources (High RAM for manifest cache)
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "2Gi"
        cpu: "1000m"

# ---------------------------------------------------------
# SCANNERS & METRICS
# ---------------------------------------------------------
trivy:
  enabled: true
  resources:
    requests:
      memory: "512Mi"
      cpu: "200m"
    limits:
      memory: "2Gi"
      cpu: "2000m"

metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    additionalLabels:
      release: "prometheus"