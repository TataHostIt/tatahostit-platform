apiVersion: v1
kind: ConfigMap
metadata:
  name: mongodb-grafana-dashboard
  namespace: mongodb
  labels:
    grafana_dashboard: "1"
    app.kubernetes.io/name: mongodb
    infra-component: databases
  annotations:
    argocd.argoproj.io/sync-wave: "10"
data:
  mongodb-dashboard.json: |
    {
      "dashboard": {
        "title": "MongoDB Cluster - TataHostIT",
        "tags": ["mongodb", "database", "percona"],
        "timezone": "browser",
        "panels": [
          {
            "title": "Replica Set Status",
            "type": "stat",
            "targets": [
              {
                "expr": "mongodb_rs_members_health",
                "legendFormat": "{{ member }}"
              }
            ]
          },
          {
            "title": "Operations per Second",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(mongodb_op_counters_total[5m])",
                "legendFormat": "{{ type }}"
              }
            ]
          },
          {
            "title": "Replication Lag",
            "type": "graph",
            "targets": [
              {
                "expr": "mongodb_rs_members_optimeDate - on(replset) group_right mongodb_rs_members_optimeDate{member_state=\"PRIMARY\"}",
                "legendFormat": "{{ member }}"
              }
            ]
          },
          {
            "title": "Connections",
            "type": "graph",
            "targets": [
              {
                "expr": "mongodb_connections",
                "legendFormat": "{{ state }}"
              }
            ]
          },
          {
            "title": "Memory Usage",
            "type": "graph",
            "targets": [
              {
                "expr": "mongodb_memory",
                "legendFormat": "{{ type }}"
              }
            ]
          },
          {
            "title": "Storage Size",
            "type": "graph",
            "targets": [
              {
                "expr": "mongodb_ss_wt_block_manager_bytes_currently_in_the_cache",
                "legendFormat": "Cache"
              }
            ]
          }
        ]
      }
    }
